<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="OrderDAO">

	<!-- 장바구니 담기  -->
	<insert id="insertCart">
		INSERT INTO orders(oseq, id, name, zipnum, addr, phone, bseq, title, image, quantity, price, result)
		VALUES(orders_seq.NEXTVAL, #{id}, #{name}, #{zipnum}, #{addr}, #{phone}, #{bseq}, #{title}, #{image}, #{quantity}, #{price}, '2')
	</insert>
	
	<!-- 장바구니 목록 조회  -->
	<select id="listCart" parameterType="String" resultType="order">
		SELECT * FROM orders
		WHERE id=#{id}
		and result = '2'
		ORDER BY indate DESC
	</select>
	
	<!-- 카트 수량 수정 -->
	<update id="updateQuantity">
		update orders set 
			quantity=#{quantity} 
			where oseq = #{oseq}
	</update>
	
	<!-- 장바구니에서 선택한 상품만 주문완료전 정보창으로  -->
	<select id="listCartView" parameterType="int" resultType="order">
		SELECT * FROM orders
		 WHERE id=#{id}
		 and result = '2'
		 and oseq=#{oseq}
		 ORDER BY oseq DESC
	</select>
	
	<!-- 장바구니에서 선택한 항목만 삭제  -->
	<delete id="deleteCart" parameterType="int">
		delete from orders
		 WHERE oseq=#{oseq}
	</delete>
	
	<!-- 장바구니에서 주문완료전 정보창으로 표시 할수있도록 result를 1로  -->
	<update id="updateCart" parameterType="int">
		UPDATE orders SET result='1'
		 WHERE oseq=#{oseq} 
	</update>

		<!-- -=-=-=-=-=-=-=회원=-=-=-=-=-=-=- -->
		
	<!-- 주문테이블에 새로운 주문 생성 -->
	<insert id="insertOrder">
		INSERT INTO orders(oseq, id, name, zipnum, addr, phone, bseq, title, image, quantity, price, result)
		VALUES(orders_seq.NEXTVAL, #{id}, #{name}, #{zipnum}, #{addr}, #{phone}, #{bseq}, #{title}, #{image}, #{quantity}, #{price}, '1')
	</insert>
	
	<!-- 마이페이지 주문목록 조회 -->
	<select id="listOrder" parameterType="hashmap" resultType="order">
		SELECT * FROM orders
		 WHERE id=#{id}
		 ORDER BY indate DESC
	</select>
	
	<!-- 주문완료전 주문정보 확인 -->
	<select id="listOrderView" parameterType="hashmap" resultType="order">
		SELECT * FROM orders
		 WHERE id=#{id}
		 and result = '1'
	</select>
	
	<!-- 주문내역 상세보기(주문번호) -->
	<select id="getOrder" parameterType="int" resultType="order">
		SELECT * FROM orders
			where oseq=#{oseq}
	</select>
	<!--배송정보 변경 -->
	<update id="updateGetOrder">
		UPDATE orders SET 
			name=#{name}, zipnum=#{zipnum}, addr=#{addr}, phone=#{phone}
			where oseq=#{oseq}
	</update>
	
	<!-- 배송정보 보기(result) -->
	<select id="getOrderResult" parameterType="String" resultType="order">
		SELECT * FROM orders
			where result='1'
			and id=#{id}
	</select>
	<!-- 주문완료전 배송 정보 변경-->
	<update id="updateOrderInfo">
		UPDATE orders SET 
			name=#{name}, zipnum=#{zipnum}, addr=#{addr}, phone=#{phone}
			where result='1'
			and id=#{id}
	</update>
	
	<!-- 주문완료 처리-->
	<update id="updateOrder" parameterType="hashmap">
		UPDATE orders SET result='3', indate=TO_char(sysdate, 'yyyy.mm.dd hh24:mi')
			WHERE result = '1'
			and id=#{id}
	</update>
	
	<!-- 주문 진행중 취소 -->
	<update id="deleteOrder" parameterType="String">
		update orders set result = '2'
			WHERE result = '1'
			and id=#{id}
	</update>
	
	<!-- 구매취소 처리-->
	<update id="updateOrderCancel" parameterType="int">
		UPDATE orders SET result='0'
		 WHERE oseq=#{oseq}
	</update>
	
	<!-- 구매확정 처리-->
	<update id="updateOrderCheck" parameterType="int">
		UPDATE orders SET result='5'
		 WHERE oseq=#{oseq}
	</update>
	
			<!-- -=-=-=-=-=-=-= 관리자 =-=-=-=-=-=-=- -->
	<!-- 전체 주문내역 조회 -->
	<select id="adminOrderList" parameterType="String" resultType="order">
		SELECT * FROM orders
		 ORDER BY indate desc
	</select>
		
	<!-- 배송완료 처리-->
	<update id="updateOrderOk" parameterType="int">
		UPDATE orders SET result='4'
		 WHERE oseq=#{oseq}
	</update>
</mapper>







